{% extends "base.html" %}
{% block header_scripts %}
<script type="text/javascript" charset="utf-8" src="/media/d3.layout.js"></script>
<script src="/media/nv.d3.js"></script>
<script src="/media/models/sparkline.js"></script>
<script src="/media/models/sparklinePlus.js"></script>
<script language="javascript" type="text/javascript">
    $(document).ready(function() {
            var oTable = $('#example').dataTable( {
                "sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
                "bPaginate": true,
                "sPaginationType": "full_numbers",
                "aaSorting": [[ 1, "desc" ]]
                });
            } );

</script>
{% endblock %}



{% block primary %}
<div class="span10">
    {% include "date_form.html" %}
    <div class="row-fluid">
        <div class="span12">
            <br><br>

            {% block content %}

            {% for dict in phrase_name %}
            <h1>{{ dict.phrase }}</h1>
            {% endfor %}

            <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered">
                <tr>{% for dict in phrase_name %}
                    <td>{{ dict.phrase }}</td>
                    {% endfor %}
                    <td>
                        <span class="inlinesparkline" style="width:40px;">
                            {% for dict in rankings %}
                            -{{ dict.position }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </span>
                    </td>
                    <tr><td>nvd3</td><td>
                            <div> <svg id="chart1" class="sparkline"></svg></div>
                    </td>
                </tr>
            </table>

            <h2>Pages accessed by this search term</h2>

            {% regroup pages by page_id__page as rank_list %}

            <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="example">
                <thead>
                    <tr>
                        <th>page</th>
                        <th>rankings</th>
                    </tr>
                </thead>
                <tbody>
                    {% for page_id__page in rank_list %}
                    <tr>
                        <td>
                            {{ page_id__page.grouper }}
                        </td>
                        <td>
                            <span class="inlinesparkline" style="width:40px;">
                                {% for item in page_id__page.list %}
                                -{{ item.position }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}

                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
                {% endblock %}
            </div>
            
 

                                       
<script>
//Format A
nv.addGraph({
  generate: function() {
    var chart = nv.models.sparklinePlus()
                  .width(400)
                  .height(50)

    d3.select("#chart1")
    .datum({{ rankings|safe }} )
      .call(chart);

    return chart;
  },
  callback: function(graph) {
    log("Sparkline rendered");
  }
});






</script>
            {% endblock %}
