{% extends "base.html" %}
{% block header_scripts %}
<style>


    #Rickshaw
    #chart_container {
        position: relative;
        font-family: Arial, Helvetica, sans-serif;
        
    }
    #chart,#ips,#se {
        position: relative;
        left: 80px;
    }
    #number {
        position: relative;
        top: 30px;
        font-size:30px;
        font-weight:bold;
        color:#948C75;
        font-family: "HelveticaNeue-CondensedBlack","Helvetica Neue Condensed Black","Impact",Helvetica,sans-serif;
    }

    .rickshaw_graph .detail .x_label { display: none }
    .rickshaw_graph .detail .item { line-height: 1.4; padding: 0.5em }
    .detail_swatch { float: right; display: inline-block; width: 10px; height: 10px; margin: 0 4px 0 0 }
    .rickshaw_graph .detail .date { color: #a0a0a0 }
</style>
{% endblock %}
</head>
<body id="dt_example">

    {% block primary %}
        <div class="container-fluid">
      <div class="row-fluid">
    <div class="span12">
        <div class="page-header">
            <h1>{{ week_ago }} to {{ latest_date }}</h1>
        </div>
        <div class="row-fluid">
            <div class="span3">
                <h2>Distinct IPs</h2>
                <div class="row-fluid">
                    <div class="span12">
                        <div id="chart_container">
                            <div id ="number">{{ ips_cnt }}<br/>{{ ip_diff }}</div>
                            <div id="ips"></div>
                        </div>
                    </div>
                </div>
            </div><!--/span-->
            <div class="span3">
                <h2>Distinct Search Engines</h2>
                <div class="row-fluid">
                    <div class="span12">
                        <div id="chart_container">
                            <div id ="number">{{ se_cnt }}</div>
                            <div id="se"></div>
                        </div>
                    </div>
                </div>
            </div><!--/span-->
            <div class="span3">
                <h2>Pages w kw delta</h2>
                <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                <p><a class="btn" href="#">View details &raquo;</a></p>
            </div><!--/span-->
            <div class="span3">
                <h2>Pages w kw delta</h2>
                <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                <p><a class="btn" href="#">View details &raquo;</a></p>
            </div><!--/span-->
        </div><!--/row-->
        <div class="row-fluid">
            <div class="span12">
                <hr/>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span3">
                {% block content %}
                <h2>New Kws</h2>
                <div class="row-fluid">
                    <div class="span12">
                        <div id="chart_container">
                            <div id ="number">{{ kw_new_cnt }}</div>
                            <div id="chart"></div>
                        </div>
                    </div>
                </div>
                <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="example">
                    <tr><td>phrase</td><td>date</td><td>ips</td></tr>
                    {% for dict in phrases_new %}
                    <tr>
                        <td>{{ dict.phrase_id__phrase }}</td><td>{{ dict.phrase_id__first_seen|date:"m-d-y" }}</td>
                        <td>{{ dict.num_ips }}</td>
                    </tr>
                    {% endfor %}

                </table>
                <a class="btn" href="#">View details &raquo;</a></p>
            </div><!--/span-->
            <div class="span3">
                <h2>Missing Kws</h2>
                <p>There were {{ wk_bf_last_cnt }} kws 2 wks ago, and {{ last_week_cnt }} kws last week</p>
                <p>below are 5 of the {{ unique_cnt }} kws that were missing from the prev wk</p>
                <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="example">
                    <tr><td>phrase</td><td>prior cnt</td></tr>
                    {% for dict in unique|slice:":5" %}
                    <tr>
                        <td>{{ dict.phrase }}</td><td></td>
                    </tr>
                    {% endfor %}

                </table>
                <p><a class="btn" href="#">View details &raquo;</a></p>
            </div><!--/span-->
            <div class="span3">
                <h2>Gaining Bigrams</h2>
                <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="example">
                    {% for bigram_tuple in bigram_gainers|slice:":5" %}
                    <tr>
                        <td>{{ bigram_tuple.0 }}</td><td>{{ bigram_tuple.1 }}</td>
                    </tr>
                    {% endfor %}

                </table>
                <p><a class="btn" href="#">View details &raquo;</a></p>
            </div><!--/span-->
            <div class="span3">
                <h2>Losing Bigrams</h2>
                <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="example">
                    {% for bigram_tuple in bigram_losers|slice:":5" %}
                    <tr>
                        <td>{{ bigram_tuple.0 }}</td><td>{{ bigram_tuple.1 }}</td>
                    </tr>
                    {% endfor %}
                    {% endblock %} 
                </table>
                <p><a class="btn" href="#">View details &raquo;</a></p>
            </div><!--/span-->
        </div><!--/row-->
        <div class="row-fluid">
            <div class="span3">
                <h2>Losing Bigrams</h2>
                <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                <p><a class="btn" href="#">View details &raquo;</a></p>
            </div><!--/span-->
            <div class="span3">
                <h2>New Pages</h2>
                <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                <p><a class="btn" href="#">View details &raquo;</a></p>
            </div><!--/span-->
            <div class="span3">
                <h2>Pages w kw delta</h2>
                <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                <p><a class="btn" href="#">View details &raquo;</a></p>
            </div><!--/span-->
        </div><!--/row-->
    </div><!--/span-->
</div><!--/row-->

<br>

<script>

    var graph = new Rickshaw.Graph( {
        element: document.querySelector("#chart"),
        width: 150,
        height: 50,
        renderer: 'bar',
        series: [{
            data: {{new_kws_cnt|safe}},
            color: '#E9967A'
        }]
    } );



    graph.render();
    var hoverDetail = new Rickshaw.Graph.HoverDetail( {
        graph: graph,
        formatter: function(series, x, y) {
            var date = '<span class="date">' + new Date(x * 1000).toUTCString() + '</span>';
            var swatch = '<span class="detail_swatch" style="background-color: ' + series.color + '"></span>';
            var content = swatch + "new kw count" + ": " + parseInt(y) + '<br>' + date;
            return content;
        }
    } );

    var graph = new Rickshaw.Graph( {
        element: document.querySelector("#ips"),
        width: 150,
        height: 50,
        renderer: 'bar',
        series: [{
            data: {{ ips_ts|safe }},
            color: '#E9967A'
        }]
    } );



    graph.render();
    var hoverDetail = new Rickshaw.Graph.HoverDetail( {
        graph: graph,
        formatter: function(series, x, y) {
            var date = '<span class="date">' + new Date(x * 1000).toUTCString() + '</span>';
            var swatch = '<span class="detail_swatch" style="background-color: ' + series.color + '"></span>';
            var content = swatch + "ip count" + ": " + parseInt(y) + '<br>' + date;
            return content;
        }
    } );
    var graph = new Rickshaw.Graph( {
        element: document.querySelector("#se"),
        width: 150,
        height: 50,
        renderer: 'bar',
        series: [{
            data: {{ se_ts|safe }},
            color: '#E9967A'
        }]
    } );



    graph.render();
    var hoverDetail = new Rickshaw.Graph.HoverDetail( {
        graph: graph,
        formatter: function(series, x, y) {
            var date = '<span class="date">' + new Date(x * 1000).toUTCString() + '</span>';
            var swatch = '<span class="detail_swatch" style="background-color: ' + series.color + '"></span>';
            var content = swatch + "se count" + ": " + parseInt(y) + '<br>' + date;
            return content;
        }
    } );
</script>
{% endblock %}
